class htmlElement{constructor(t){this.element=t}copy(){return this.element.clone()}remove(){this.element.remove()}append(t){this.element.append(t)}}class tetragon3d extends htmlElement{constructor(t,e){super(t),this.baseSpeed=e>1?1:e,this.rotationSpeed=e>1?1:e,this.clickedId="",this.faces=this.element.children(".face"),this.easing=[],this.speedMeasure={start:void 0,stop:void 0,lastMeasuredAngle:void 0,speedArr:[],avgSpeed:void 0},this.motionData={isAboutToStop:!1,currentAngle:0,targetAngle:void 0,move:!0},this.dynamicContent={content:1,willUpdate:!0}}calculateEntryValues(){this.speedMeasure.avgSpeed=30/(60*this.rotationSpeed)}animateElement(){if(this.speedMeasure.avgSpeed||this.calculateEntryValues(),this.motionData.move){let t=this.computeRotatingTime();this.computeAvgSpeed(t),this.updateContent(),0!==this.easing.length&&this.applyEasing(),0===this.easing.length&&this.rotationSpeed<this.baseSpeed&&this.accelerate(),this.motionData.currentAngle-=this.rotationSpeed,this.motionData.currentAngle=this.motionData.currentAngle<=-360?0:this.motionData.currentAngle,this.element.css("transform",` translateZ(-250px) rotateY(${this.motionData.currentAngle}deg)`),Math.round(this.motionData.currentAngle)===this.motionData.targetAngle&&(this.motionData.move=!1,this.element.css("transform",` translateZ(-250px) rotateY(${this.motionData.targetAngle}deg)`)),window.requestAnimationFrame(()=>this.animateElement())}else this.animatePlane()}computeEasing(t){let e,a,n,i,s,o,r=Math.abs(Math.abs(this.motionData.targetAngle)-Math.abs(this.motionData.currentAngle)),h=r<20?5:10,l=[],c=this.rotationSpeed;switch(!0){case r<=10:a=0;break;case r<=20:a=3;break;case r<=30:a=8;break;case r<=40:a=15;break;case r<=50:a=24;break;case r<=60:a=32;break;case r<=70:a=40;break;case r<=80:a=50;break;case r<=90:a=60}e=(r-a)/h,i=c/h,n=c,o=s="forth"===t?this.motionData.currentAngle-a:this.motionData.currentAngle+a,e="forth"===t?-e:e;for(let t=1;t<h;t++)o+=e,n=(n-=i)>0?n<.1?.1:n:n>-.1?-.1:n,l[t-1]=[],l[t-1].push(Math.round(o)),l[t-1].push(parseFloat(n.toFixed(2)));return l}applyEasing(){this.easing.forEach(t=>{Math.round(this.motionData.currentAngle)===t[0]&&(this.rotationSpeed=t[1])})}computeRotatingTime(){let t,e=Math.abs(Math.floor(this.motionData.currentAngle)),a=!(e%31);return this.speedMeasure.lastMeasuredAngle===e?null:(this.speedMeasure.lastMeasuredAngle=e,this.speedMeasure.measureAngle===e?(this.speedMeasure.stop=new Date,t=(this.speedMeasure.stop-this.speedMeasure.start)/1e3):(a&&(this.speedMeasure.measureAngle=360===this.motionData.currentAngle?30:e+30,this.speedMeasure.start=new Date),null))}computeAvgSpeed(t){null!==t&&(this.speedMeasure.speedArr.push(t),this.speedMeasure.speedArr.length>4&&this.speedMeasure.speedArr.shift(),this.speedMeasure.avgSpeed=this.speedMeasure.speedArr.reduce((t,e)=>t+e,0)/this.speedMeasure.speedArr.length)}getTargetAngle(t){switch($(t.target).attr("id")){case"front":this.motionData.targetAngle=0;break;case"right":this.motionData.targetAngle=-90;break;case"back":this.motionData.targetAngle=-180;break;case"left":this.motionData.targetAngle=-270}}shouldChangeDirection(){let t="forth";return 0===this.motionData.targetAngle?(this.rotationSpeed=this.motionData.currentAngle<-180?this.rotationSpeed:-this.rotationSpeed,t=this.motionData.currentAngle<-180?"forth":"back"):this.motionData.currentAngle<this.motionData.targetAngle&&(this.rotationSpeed=-this.rotationSpeed,t="back"),t}animatePlane(){this.faces.filter((t,e)=>$(e).attr("id")===this.clickedId).addClass("focus")}planeClickEvent(){this.faces.on("click",t=>{if(!this.motionData.isAboutToStop){let e=$(t.currentTarget);t.stopPropagation(),this.getTargetAngle(t),this.clickedId=t.target.id;let a=this.shouldChangeDirection();this.motionData.isAboutToStop=!0,this.easing=this.computeEasing(a),e.css("cursor","initial"),$("body").css("cursor","pointer").one("click",t=>{this.motionData.isAboutToStop=!1,e.css("cursor","pointer"),$(t.currentTarget).css("cursor","initial"),this.restoreAnimation()})}})}restoreAnimation(){let t=this.faces.filter((t,e)=>$(e).attr("id")===this.clickedId);t.removeClass("focus"),this.easing=[],this.motionData.move=!0,this.motionData.targetAngle=void 0,this.clickedId="",this.rotationSpeed=this.rotationSpeed<0?-this.rotationSpeed:this.rotationSpeed,t.one("transitionend",()=>{this.animateElement()})}accelerate(){this.rotationSpeed=parseFloat((this.rotationSpeed+.005).toFixed(3))}updateContent(){this.motionData.currentAngle<-10&&this.motionData.currentAngle>-20&&this.dynamicContent.willUpdate?(this.dynamicContent.content=this.dynamicContent.content+2,this.dynamicContent.willUpdate=!1,$(this.faces[2]).text(`face ${this.dynamicContent.content}`),$(this.faces[3]).text(`face ${this.dynamicContent.content+1}`)):this.motionData.currentAngle<-20&&this.motionData.currentAngle>-30&&!this.dynamicContent.willUpdate?this.dynamicContent.willUpdate=!0:this.motionData.currentAngle<-180&&this.motionData.currentAngle>-190&&this.dynamicContent.willUpdate?(this.dynamicContent.content=this.dynamicContent.content+2,this.dynamicContent.willUpdate=!1,$(this.faces[0]).text(`face ${this.dynamicContent.content}`),$(this.faces[1]).text(`face ${this.dynamicContent.content+1}`)):this.motionData.currentAngle<-190&&this.motionData.currentAngle>-200&&!this.dynamicContent.willUpdate&&(this.dynamicContent.willUpdate=!0)}}let myElement=new tetragon3d($("#top-layer"),.5);$(()=>{myElement.animateElement(),myElement.planeClickEvent()});
//# sourceMappingURL=main.js.map
